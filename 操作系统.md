# 操作系统



## 一、操作系统入门



![image-20211012120701398](C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012120701398.png)

### 1. 概念

现代计算机系统由一个或多个处理器、主存、打印机、键盘、鼠标、显示器、网络接口以及各种输入/输出设备构成。

而在这些硬件之上还有一层操作系统如：Windows、Linux、FreeBSD、OS X，这种带有界面的成为GUI_`Graphical User Interface`，基于文本、命令行的称之为`shell`。

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012120337966.png" alt="image-20211012120337966" style="zoom:67%;" />

**操作系统是硬件和用户之间的桥梁。**

计算机有两种运行模式`用户态`和`内核态`。软件中最基础的部分是`操作系统`，他位于`内核态`，也称之为`管态`和`核心态`。



### 2. 计算机硬件介绍

![image-20211012120957668](C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012120957668.png)

MMU：Memory Management Unit。内存管理单元。主要功能是提供虚拟地址和物理地址之间的转换。

**总线分别连到了XX控制器，而不是直接连到了各种设备上。**



#### 2.1 CPU

一个CPU的**执行周期**是从内存中提取第一条指令、解码并确定它的类型和操作数，执行，然后下一条指令。

每个CPU都有一个特定的可以执行的指令集，也就是x86的和ARM的不能互相跑。



**流水线CPU(pipeline)**

当 CPU 执行第 N 条指令时，还可以对 N + 1 条指令解码，还可以读取 N + 2 条指令。

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012122907653.png" alt="image-20211012122907653" style="zoom:67%;" />



**超标量CPU(superscalar)**

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012123149108.png" alt="image-20211012123149108" style="zoom:67%;" />

在上面这个设计中，存在多个执行单元，例如，一个用来进行整数运算、一个用来浮点数运算、一个用来布尔运算。两个或者更多的指令被一次性取出、解码并放入缓冲区中，直至它们执行完毕。只要一个执行单元空闲，就会去检查缓冲区是否有可以执行的指令。

这种设计的含义是应用程序通常是无序执行的。

为了获取操作系统的服务，用户程序必须使用 `系统调用(system call)`，系统调用会转换为内核态并且调用操作系统。`TRAP` 指令用于把用户态切换为内核态并启用操作系统。当有关工作完成之后，在系统调用后面的指令会把控制权交给用户程序。

操作系统在进行系统调用时会存在陷阱。大部分陷阱会导致硬件发出警告，比如除以零或者浮点下溢。（由于出错，程序不得不停止）



#### 2.2 多线程和多核芯片

多线程允许 CPU **保持两个**不同的线程状态并且在`纳秒级(nanosecond)` 的时间**完成切换**。线程是一种轻量级的进程，我们会在后面说到。例如，如果一个进程想要从内存中读取指令(这通常会经历几个时钟周期)，多线程 CPU 则可以切换至另一个线程。多线程不会提供真正的并行处理。在一个时刻只有一个进程在运行。

==**并行：**同时做A和B两件事。==

==**并发：**事件A和B轮流做。==

**单CPU多线程可以提供并发能力，多CPU可以提供并行能力。**

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012133248995.png" alt="image-20211012133248995" style="zoom:67%;" />

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012133741385.png" alt="image-20211012133741385" style="zoom:67%;" />

GPU （Graphics Processing Unit）是指由成千上万个微核组成的处理器。它们擅长处理大量并行的简单计算。



#### 2.3 内存

存储器系统采用了一种分层次的结构。

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012134518135.png" alt="image-20211012134518135" style="zoom:67%;" />

速度是上面这个关系，造价也是如此。



**寄存器**

顶层的寄存器用的材料和CPU一样，所以速度也和CPU一样快。程序必须在软件中自行管理这些寄存器。



**高速缓存**

由硬件控制，被分割成了**高速缓存行**。当需要访问数据的时候，会先去高速缓存中找，如果找到了，称之为高速缓存命中，只需要两个时钟周期，反之则会去内存里面找，会花费大量时间。

也会有多级缓存。每一级都比前一级容量大且速度慢，里面存储的数据也是由高频率决定的。

在任何缓存系统中，都会有下面这几个急需解决的问题：

- 何时把新的内容放进缓存
- 把新的内容应该放在缓存的哪一行
- 在需要空闲空间时，应该把哪块内容从缓存中移除
- 应该把移除的内容放在某个较大存储器的何处

**时钟周期**指的是振荡器两个脉冲之间的时间量。一个4 GHz处理器每秒执行4,000,000,000个时钟周期。



**主存**

主存是内存系统的主力军，主存又称之为RAM(Random Access Memory)。

**随机存取器(RAM)：**既可以读取也可以写入，当机器关闭后，内存中的数据会丢失。（也就是我们常说的运行内存）

许多计算机还具有少量的非易失性随机存取存储器（ROM——Read Only Memory），断电后，数据不会丢失。

还有一类ROM是类似与EEPROM和闪存，他们可以擦除和重写，不过重写消耗时间过久，一般当作普通的ROM使用。闪存指的是便携性的存储媒介，如胶卷、磁盘等。（擦除过多次会有损耗）

还有一类是CMOS，他是易失的，许多计算机会用它来存储当前的时间和日期。



**磁盘**

磁盘的访问速度慢是由于磁盘的构造不同的原因。

<img src="C:\Users\18343\AppData\Roaming\Typora\typora-user-images\image-20211012142116604.png" alt="image-20211012142116604" style="zoom:67%;" />

低端硬盘的速率是`50MB/s`，而高速磁盘的速率是 `160MB/s`。

`固态硬盘(Solid State Disk, SSD)`不是磁盘，固态硬盘并没有可以移动的部分，外形也不像唱片，并且数据是存储在存储器（闪存）中，与磁盘唯一的相似之处就是它也存储了大量即使在电源关闭也不会丢失的数据。

许多计算机支持一种著名的 **`虚拟内存机制`** ，这种机制使得期望运行的存储空间大于实际的物理存储空间。<u>其方法是将程序放在磁盘上，而将主存作为一部分缓存，用来保存最频繁使用的部分程序，这种机制需要快速映像内存地址，用来把程序生成的地址转换为有关字节在 RAM 中的物理地址。</u>**这种映像由 CPU 中的一个称为 存储器管理单元(Memory Management Unit, MMU) 的部件来完成。**

